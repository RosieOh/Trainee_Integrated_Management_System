<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{include/layout}">

<div layout:fragment="content">
    <div class="admin-content">
        <div class="admin_box ">
            <h2>강의 리스트</h2>
            <table class="table_set">
                <thead>
                <tr>
                    <th style="width: 8%">과정</th>
                    <th style="width: 5%">기수</th>
                    <th style="width: 15%">시작일</th>
                    <th style="width: 15%">종료일</th>
                    <th style="width: 15%">80% 경과일자</th>
                    <th>대표강사</th>
                    <th>담당 매니저</th>
                    <th style="width: 15%">공개여부</th>
                    <th style="width: 5%"></th>
                </tr>
                </thead>
                <tbody>
                    <tr class="course_add">
                        <td colspan="10"> <i class="far fa-plus-square"></i> 강의추가하기</td>
                    </tr>
                    <form th:action="@{/admin/coursePro}" method="post" onsubmit="return formCheck()">
                        <tr class="board_box course_input">
                        <td class="board_box ">
                            <select name="subject" >
                                <option value="BIGDATA"> 빅데이터 </option>
                                <option value="FULLSTACK"> 풀스택 </option>
                                <option value="PM"> PM </option>
                            </select>
                        </td>
                        <td >
                            <input type="number" name="flag" placeholder="0" required/>
                        </td>
                        <td >
                            <div class="course_cal">
                                <input type="date" name="start_date" id="start_date" min="1960-01-01" max="2040-12-31" required/>
                            </div>
                        </td>
                        <td >
                            <div class="course_cal">
                                <input type="date" name="end_date" id="end_date" min="1960-01-01" max="2040-12-31" required/>
                            </div>
                        </td>
                        <td >
                            <div class="course_cal">
                                <input type="date" name="train_time" id="train_time" min="1960-01-01" max="2040-12-31" disabled/>
                            </div>
                        </td>
                        <td >
                            <input type="text" name="instructor" placeholder="강사이름" required/>
                        </td>
                        <td >
                            <input type="text" name="manager" placeholder="담당매니저" required/>
                            <input type="hidden" name="delete_type" value="n"/>
                        </td>
                        <td>
                            <button type="submit" class="form_button select_btn">강의등록</button>
<!--                            <button type="button" class="form_button cancel_btn" onclick="asdf()">확인</button>-->
                        </td>
                        <td></td>
                      </tr>
                  </form>
                </tbody>
                <tbody>
                <tr th:each="course, about :${courseDTOList}">
                    <td th:if="${#strings.equals(course.subject, 'BIGDATA')}">빅데이터</td>
                    <td th:if="${#strings.equals(course.subject, 'EXCEPTION')}">예외</td>
                    <td th:if="${#strings.equals(course.subject, 'FULLSTACK')}">풀스택</td>
                    <td th:if="${#strings.equals(course.subject, 'PM')}">PM</td>
                    <td th:text="${course.flag} + ' 기'"></td>
                    <td th:text="${course.start_date}"></td>
                    <td th:text="${course.end_date}"></td>
                    <td th:text="${course.train_time}"></td>
                    <td th:text="${course.instructor}"></td>
                    <td th:text="${course.manager}"></td>
                    <td >
                        <form th:action="@{/admin/course_delete(no=${course.no})}" method="post" class="inline_form">
                            <select name="delete_type" id="delete_type" class="select-box">
                                <option value="y" th:selected="${course.delete_type} eq 'y'">공개</option>
                                <option value="n" th:selected="${course.delete_type} eq 'n'">비공개</option>
                            </select>
                            <button type="submit" class="inline_form_btn select_btn" >상태 변경<i class="fas fa-pencil-alt"></i></button>
                        </form>
                    </td>
                    <td>
                        <a th:href="@{/admin/course_edit(no=${course.getNo()})}" class="inline_form_btn edit_btn" >수정하기<i class="fas fa-pencil-alt"></i></a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function asdf() {


            let start = document.getElementById("start_date").value;
            let date = new Date(start)
            let diff = Math.abs(date.getTime() + 150);
            diff = Math.ceil(diff / (1000 * 60 * 60 * 24));
            alert("1번 뭘까: " + diff);
            console.log(diff);
            // alert("1번 뭘까: " + start.getDate());
            // alert("2번 뭘까: " + date.getDate() + 90);

        }
    </script>
    <script>
        let course_add = document.querySelector('.course_add')
        let course_input = document.querySelector('.course_input')
        course_add.addEventListener('click', function (){
            this.style.display = "none";
            course_input.style.display = "table-row";
        })
    </script>
    <script>
        // 시작일 변경 시 종료일 처리
        $("#start_date").change(() => {
            $("#end_date").prop("min", $("#start_date").val());
            // 종료일이 변경한 시작일보다 빠른 경우
            if($("#end_date").val() < $("#start_date").val()) {
                $("#end_date").val($("#start_date").val());
            }
        });
        // 종료일 변경 시 시작일 처리
        $("#end_date").change(() => {
            $("#start_date").prop("max", $("#end_date").val());
        })
    </script>
    <script>
        // function Datetime(date){
        //     var year = date.getFullYear();
        //     var month = (1 + date.getMonth());
        //     month = month >= 10 ? month : '0' + month;
        //     var day = date.getDate();
        //     day = day >= 10 ? day : '0' + day;
        //     return  year + '-' + month + '-' + day;
        // }
        //
        // function Train_time() {
        //     let start_date = document.getElementById("start_date").value;
        //     let train_time = document.getElementById("train_time");
        //
        //     console.log("start_date.getDate()" + start_date.getDate());
        //     console.log("train_time.getDate()" + train_time.getDate());
        //
        // }
        //
        // date.setDate(date.getDate()*1.8);
        //
        // let maxDate = Train_time(date);
        //
        // if (start_date < minDate) {
        //     toastr.options.preventDuplicates = true;
        //     toastr.warning("오늘 이후의 날짜를 선택해주세요");
        //     $("#offerdate").focus();
        //     return false;
        // }
        //
        //
        // if (offerdate > maxDate) {
        //     toastr.options.preventDuplicates = true;
        //     toastr.warning("+90일까지 설정 가능합니다.");
        //     $("#offerdate").focus();
        //
        //     return false;
        // }
    </script>
    <script>
        function formCheck(){


            // 시작날짜
            if($("#start_date1").val() == "" || $("#start_date2").val() == "" || $("#start_date3").val() == "") {
                alert("시작날짜가 정확하지 않습니다.")
                return false
            }

            let start_date =  $("#start_date1").val() +'.'+ $("#start_date2").val() +'.'+ $("#start_date3").val()
            $("#start_date").val(start_date)

            if($("#start_date1").val() > $("#end_date1").val()){
                alert("종료날짜 연도에 문제가 있습니다.")
                return false
            }

            if(($("#start_date1").val() == $("#end_date1").val()) && ($("#start_date2").val() > $("#end_date2").val())){
                alert("종료날짜 월에 문제가 있습니다.")
                return false
            }
            if(($("#start_date1").val() == $("#end_date1").val()) && ($("#start_date2").val() == $("#end_date2").val()) && ($("#start_date3").val() >= $("#end_date3").val())){
                alert("종료날짜 일자에 문제가 있습니다.")
                return false
            }



            // 종료날짜
            if($("#end_date1").val() == "" || $("#end_date2").val() == "" || $("#end_date3").val() == "") {
                alert("종료날짜가 정확하지 않습니다.")
                return false
            }
            let end_date =  $("#end_date1").val() +'.'+ $("#end_date2").val() +'.'+ $("#end_date3").val()
            $("#end_date").val(end_date)



            // 수료도 80%
            if($("#train_time1").val() == "" || $("#train_time2").val() == "" || $("#train_time3").val() == "") {
                alert("수료도가 정확하지 않습니다.")
                return false
            }
            let train_time =  $("#train_time1").val() +'.'+ $("#train_time2").val() +'.'+ $("#train_time3").val()
            $("#train_time").val(train_time)
        }
    </script>
    <script>
        $(document).ready(function(){
            $(".change_input").prop('readonly', true)

        })
    </script>
    <script>
        function inputa(e){
            $(".inputCh").attr('readonly', false)
        }
    </script>
</div>
