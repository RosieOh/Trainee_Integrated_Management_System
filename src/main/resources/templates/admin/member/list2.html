<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{include/layout}">

<div layout:fragment="content">
  <script th:inline="javascript">
    let msg = [[${msg}]]
    console.log(msg)
    if(msg != null){
      alert(msg);
    }
  </script>
  <div class="main_title">
    <h1>회원관리</h1>
  </div>
  <div class="admin-content memlist">
    <div class="table_group">
      <div class="selectSearch">
          <select name="" id="subject" required>
            <option value="all">==전체과정==</option>
            <option value="big">빅데이터</option>
            <option value="full">풀스택</option>
            <option value="pm">PM</option>
          </select>
          <select class="custom-select" id="flag" name="">
              <option value="all">==전체기수==</option>
              <th:block th:each="course_big : ${course_big_List}">
                  <option th:value="${course_big.getNo()}" th:text="${course_big.flag} + '기'" class="flag_big"></option>
              </th:block>
              <th:block th:each="course_full : ${course_full_List}">
                  <option th:value="${course_full.getNo()}" th:text=" ${course_full.flag} + '기'" class="flag_full"></option>
              </th:block>
              <th:block th:each="course_pm : ${course_pm_List}">
                  <option th:value="${course_pm.getNo()}" th:text=" ${course_pm.flag} + '기'" class="flag_pm"></option>
              </th:block>
          </select>
          <script>
              document.getElementById('subject').addEventListener('change', function() {
                  var subject = this.value;
                  var optionsBig = document.querySelectorAll('.flag_big');
                  var optionsFull = document.querySelectorAll('.flag_full');
                  var optionsPm = document.querySelectorAll('.flag_pm');

                  if (subject === 'big') {
                      optionsFull.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsPm.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsBig.forEach(function(option) {
                          option.style.display = 'block';
                      });
                  } else if (subject === 'full') {
                      optionsBig.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsPm.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsFull.forEach(function(option) {
                          option.style.display = 'block';
                      });
                  } else if (subject === 'pm') {
                      optionsFull.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsBig.forEach(function(option) {
                          option.style.display = 'none';
                      });
                      optionsPm.forEach(function(option) {
                          option.style.display = 'block';
                      });
                  }
              });
          </script>

          <select name="" id="role">
              <option value="all">==전체회원==</option>
              <option value="teacher">강사</option>
              <option value="student">학생</option>
          </select>
          <div th:replace="/include/search :: search('/admin/memList')"></div>


      </div>

      <table class="table_set">
        <thead>
        <tr>
          <th>클래스</th>
          <th>이름</th>
          <th>이메일</th>
          <th>성별</th>
          <th>생년월일</th>
          <th>연락처</th>
          <th>가입날짜</th>
          <th>상태</th>
          <th>권한</th>
        </tr>
        </thead>
        <tbody>
        <th:block th:if="${#lists.isEmpty(list)}">
          <tr>
            <td colspan="8" class="board_td">
              <h4>현재 내용이 없습니다.</h4>
            </td>
          </tr>
        </th:block>
        <tr th:each="member, about :${list}">
            <td th:if="${#strings.equals(member.course.subject, 'BIGDATA')}">빅데이터 [[${member.course.flag}]]기</td>
            <td th:if="${#strings.equals(member.course.subject, 'FULLSTACK')}">풀스택 [[${member.course.flag}]]기</td>
            <td th:if="${#strings.equals(member.course.subject, 'PM')}">PM [[${member.course.flag}]]기</td>
            <td th:if="${#strings.equals(member.course.subject, 'EXCEPTION')}">예외</td>
            <td>
              <a th:href="@{/admin/member_read(no=${member.getNo() } )}">[[${member.name }]]  <i class='fas fa-sign-in-alt'></i> </a>
            </td>
            <td th:text="${member.email}"></td>
            <td th:text="${member.gender}"></td>
            <td th:text="${member.birth}"></td>
            <td th:text="${member.phone}"></td>
            <td th:text="${#temporals.format(member.createdTime, 'yyyy-MM-dd hh:mm')}"></td>
            <td>
              <form th:action="@{/admin/change_status(id=${member.id} )}" method="post" class="inline_form">
                <select name="status" id="delete_type" class="select-box" >
                  <option value="ACTIVE" th:selected="${#strings.equals(member.status, 'ACTIVE')}">활동</option>
                  <option value="REST" th:selected="${#strings.equals(member.status, 'REST')}">휴면</option>
                  <option value="OUT" th:selected="${#strings.equals(member.status, 'OUT')}">탈퇴</option>
                </select>
                <button type="submit" class="inline_form_btn select_btn" >상태 변경<i class="fas fa-pencil-alt"></i></button>
              </form>
            </td>
            <td>
              <form th:action="@{/admin/change_role(id=${member.id} )}" method="post" class="inline_form">
                <select name="role" class="select-box">
                  <option value="ADMIN" th:selected="${#strings.equals(member.role, 'ADMIN')}">관리자</option>
                  <option value="MANAGER" th:selected="${#strings.equals(member.role, 'MANAGER')}">매니저</option>
                  <option value="TEACHER" th:selected="${#strings.equals(member.role, 'TEACHER')}">선생님</option>
                  <option value="STUDENT" th:selected="${#strings.equals(member.role, 'STUDENT')}">학생</option>
                </select>
                <button type="submit" class="inline_form_btn select_btn" >권한 변경 <i class="fas fa-pencil-alt"></i></button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>

      <th:block th:replace="~{/include/page :: pagination(pageLink=@{'/admin/memList'})}"></th:block>

    </div>
  </div>
</div>

